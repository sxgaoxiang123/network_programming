# 库的概念

有时候需要把一组代码编译成一个库，这个库在很多项目中都要用到，例如libc就是这样一个库，在不同的程序中都会用到libc中的哭喊叔（例如printf），也会用到libc中的变量





# 静态库

1. 创建多个自定义函数文件：*.c
2. 编译生成目标文件：gcc -c *.c 生成 *.o 目标文件
3. 打包目标文件到静态库：ar rs libxxx.a *.o
4. 编译链接静态库：gcc main.c -L. -lxxx -Ixxx -o main
   - -L：指定库的路径
   - -l：指定库的名字，**注意对于库libxxx.a来说lib是固定前缀，.a是固定后缀，xxx才是库的名字**
   - -I：指定头文件的名字
   - -o：指定目标文件的名字





# 共享库（动态库）

1. 创建多个自定义函数文件：*.c

2. 编译生成目标文件：

   -f后面跟一些编译选项，PIC是其中一种，表示生成位置无关代码

   gcc -c -fPIC *.c

3. 编译生成共享库：gcc -shared -o libstack.so *.o

4. 编译链接静态库：gcc main.c -L -lxxx -Ixxx -o main

5. 运行报错，可以使用：ldd main 命令查看main的外部链接库路径
6. 共享库搜索路径：
   1. 首先在环境变量LD_LIBRARY_PATH所记录的路径中查找
   2. 然后从缓存文件/etc/ld.so.cache中查找
   3. 如果上述步骤都找不到，则到默认的系统路径中查找，先是/usr/lib然后是/lib
   4. 在编译可执行文件main的时候就把libstack.so的路径写死在可执行文件中

