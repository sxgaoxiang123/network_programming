# 动态路由算法

## 静态路由协议

路由器是一台网络设备，它有多张网卡

当一个入口的网络包送达路由器时，它会更具一个被第的转发信息库，来决定如何正确地转发流量，这个转发信息库通常呗称作**路由表**

网络管理员可以手工修改路由表中的路由协议，这种方式叫做**静态路由协议**

静态路由协议时用于网络环境简单的场景



## 动态路由协议

使用动态路由器，可以更具路由西已算法生成动态路由表，随网络运行状态的变化而变化

可以将复杂的路经，抽象成一种**图的数据结构**，因此转化为如何在图中找到最短路经的问题



## 不同的动态路由算法

### 距离矢量路由算法

距离矢量路由（distance vector routing），它是基于Bellman-Ford算法得来的。

算法基本思路：

- 每个路由都包村一个路由表，包含多行
- 每行对应网络中的一个路由器，每行包含两部分信息
  - 到达目标路由器，从哪条线触发
  - 到目标路由器的距离
- 每个路由器都是直到全局信息的
- 信息更新方式
  - 每个路由器都知道自己和其他路由器之间的距离
  - 每过几秒，每个路由器都将自己锁直到的到达所有其他路由器的距离告知邻居
  - 每个路由器也能从邻居哪里得到相似信息
  - 每个路由器根据新搜集到的信息，计算和其他路由器的距离，比如自己的一个另据距离目标路由器的距离是M，而自己距离邻居是x，则自己距离目标路由器的距离是M + x

**算法的问题：**

1. 好消息传得块，坏消息传得慢：如果某个网络节点丢失了，那么其他节点会相互质询，形成循环，跳数会不断叠加，直到增大到某个阈值才人为该节点真的丢失了
2. 每次发送都要发送整个全局路由表：会造成网络拥堵，导致算法仅适用于小型网络（小于15跳）

以上两个问题，限制了距离矢量路由的网络规模

### 链路状态路由算法

链路状态路由算法（link state routing），基于Dijkstra算法实现

算法基本思路：

- 当一个路由器启动的时候，首先是发现邻居，它会向邻居发送信息，邻居都会回复
- 然后计算自己和邻居的距离，发送一个echo，要求马上返回，除以2就是距离
- 然后将自己和邻居之间的链路状态包广播出去，发送到整个网络的每个路由器
- 这样每个路由器都能够受到新增路由器和它邻居之间的关系信息
- 每个路由器都能在自己本地构建一个完整的图，然后针对这个图使用Dijkstra算法，找到两点之间的最短路径

算法优势：

- 更新时只广播更新的或改变的网络拓扑，这样可以使得更新信息更小，节省带宽和CPU利用率
- 一旦一个路由器挂了，它的邻居都会广播这个信息，可以使得坏消息迅速收敛

### 开放式最短路径优先算法

Open Shortest Path First

该算法基于链路状态路由算法，广泛应用在数据中心的场景中，用于路由决策，称为内部网关协议（Interior Gateway Protocol）

内部网关协议的终点就是找到最短路径，当OSPF发现多个最短路径后，可以在这些路径中进行负载均衡，这常常被称为**等价路由**

### BGP协议

BGP协议使用的算法时路径矢量路由协议，它是距离矢量路由的升级版

BGP是自治系统间的路由协议，BGP交换的网络可达信息提供了足够的信息来检测路由回路并根据新能优先和策略约束对路由进行决策

