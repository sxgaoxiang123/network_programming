# 路由器

![image-20211109232719090](/home/gaoxiang/.config/Typora/typora-user-images/image-20211109232719090.png)

## 家庭路由器

家庭路由器会有内网网口和外网网口，把外网网口的线插入光猫拉出的网线端口上，将这个外网网口配制成和光猫的局域网一样的网段。内网网口链接家庭网络设备（都在一个局域网内）

路由器将多个局域网相连，每个局域网的出口就叫做**网关**



## 相同局域网内终端相互访问

如果在同一网段，即设备都在同一个局域网中，它们之间的相互访问，无需经过网关

直接将源地址和目标地址放入IP头，然后通过ARP获得MAC地址，将源MAC和目标MAC放入MAC头中就可以发送并实现通信了



## 不同局域网终端的访问

如果两个设备属于不同的局域网，那就需要发往默认网关Gateway了

Gateway的地址一定是和源IP地址一个网段的，且往往不是第一个就是第二个，例如源IP是192.168.1.0./24，那么Gateway往往是192.168.1.1/24或192.168.1.2/24

### 如何发往默认网关

网关和源IP地址处于相同网段，这个发送过程和发往同一网段的其他机器一样

1. 将源IP地址和目标IP地址放入IP头中
2. 通过ARP获得网关的MAC地址
3. 将源MAC和网关的MAC放入MAC头中，发送出去



# 网关

网关往往是一个路由器，是一个三层转发设备

所谓三层是因为网关会把MAC头和IP头都去下来，然后根据里面的内容，看接下来把包发往哪里

## 网关和路由器的区别

网关不能直接和路由器对等，准确的说，路由器是一台设备，它有多个网口或网卡，分别连着多个局域网

每个网卡的IP地址都和局域网的IP地址具有相同的网段，每个网卡都是它所在的那个局域网的网关

任何一个想发往其他局域网的包，都会到达其中一个网关，数据包被网关获取后会拆包分析MAC头和IP头，再根据相应的路由算法，选择另一个网口，加上IP头和MAC头，发送出去