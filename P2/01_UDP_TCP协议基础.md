# UDP协议

![image-20211111081254083](/home/gaoxiang/.config/Typora/typora-user-images/image-20211111081254083.png)

- 端口号范围L：0 - 2^16 - 1，其中0 - 1023被很多软件固定占用，客户端程序的端口不必是well-known的，往往是每次运行客户端程序时，由系统自动分配一个空闲的端口号，用完就释放掉，称为ephemeral端口号



## UDP协议特性

UDP协议不面向链接，也不保证传输的可靠性

- 发送端的UDP协议层只管把应用层传来的数据封装成段交给IP协议层，如果因为网络故障信息没有递达，UDP协议层也不会给应用层返回任何错误信息
- 接收端的UDP协议层只管把收到的数据根据端口号交给相应的应用程序，如果发送端发来多个数据包并且在网络上经过不同的路由，到达接收端时顺序已经错乱，UDP协议层也不保证按发送时的顺序交给应用层
- 通常接收端的UDP协议层将收到的数据放在一个固定大小的缓冲区中等待应用程序来提取和处理，如果用用程序提取和处理的速度很慢，而发送端发送的速度很快就会丢包，UDP协议层并不报告这种错误



## UDP协议使用场景

由于UDP协议的特性，使用这种协议的应用程序必须考虑到这些可能的问题并实现适当的解决方案，例如：等待应答、超时重法、为数据包编号、流量控制等

UDP协议适用于比较简单的应用程序，只是发送一些对可靠性要求不高的消息，而不发送大量数据

适用场景：

1. 需要资源少，在网络情况比较好的内网，或者对于丢包不敏感的应用
2. 不需要一对一沟通，建立链接，而是可以广播的应用
3. 需要处理速度快，时延低，可以容忍少数丢包，并且不考虑网络拥塞

商业案例：

1. 流媒体协议
2. 实时游戏
3. IoT物联网
4. 移动通信领域





# TCP 协议

![image-20211111090309911](/home/gaoxiang/.config/Typora/typora-user-images/image-20211111090309911.png)



## TCP报文内容

- 源端口号和目标端口号和UDP协议类似，指明数据的来源和目的地

- 包的序号：为了解决数据乱序的问题，

- 确认序号：数据接收方需要应答每条数据的接收状态，如果某条每收到就需要重新发送，可以解决不丢包的问题

- 一些状态位：

  - SYN：发起一个连接
  - ACK：回复
  - RST：重新链接
  - FIN：结束链接

  TCP时面向连接的，收发双方要维护连接的状态，这些带状态位的包的发送会引起双方的状态变更

- 窗口大小：TCP要做到流量控制，通信双方各声明一个窗口，标识自己当前的处理能力，以此来规定传输的流量大小



## TCP 头部的解析

通过对TCP头的解析，需要重点关注如下几个问题

- 顺序问题
- 丢包问题
- 连接维护
- 流量控制
- 拥塞控制

