# HTTP协议

超文本传输协议（Hyper Text Transfer Protocol，缩写HTTP）是一种用于分布式、协作式和超媒体信息系统的应用层协议，HTTP是www的数据通信基础



## HTTP特点

1. HTTP协议采用了请求/响应模型（一通就断）

   ![image-20211118210823181](/home/gaoxiang/.config/Typora/typora-user-images/image-20211118210823181.png)

2. 无状态保存：HTTP是一种不保存状态，即无状态（stateless）协议，HTTP协议本身不对请求和响应之间的通信状态进行保存，即在HTTP这个层级，协议对于发送过的请求或响应都不做持久化处理

   ![image-20211118211026267](/home/gaoxiang/.config/Typora/typora-user-images/image-20211118211026267.png)

   3. 无连接：限制每次连接只处理一个请求。服务器处理万客户的请求，并受到客户的应答后，即断开连接，采用这种方式可以节省传输时间，并可以提高并法性能，不能和每个客户端建立长久的连接，请求一次响应一次，服务器和客户端就中断了



## HTTP请求方法

HTTP/1.1协议中共定义了8中方法（也叫“动作”）来以不同方式操作指定的资源

1. GET：向指定的资源发出“显示”请求
2. POST：向指定资源提交数据，请求服务器进行处理（例如提交表单或上传文件），数据包含在请求本文中
3. HEAD：与GET一样都是向服务器发出指定资源的请求，只不过服务器将不传回资源的本文部分
4. PUT：向指定资源位置上传其最新内容
5. DELETE：请求服务器删除Request-URI所标识的资源
6. TRACE：回显服务器收到的请求，主要用于测试或诊断
7. OPTIONS：此方法可使服务器传回该资源所支持的所有HTTP请求方法
8. CONNECT：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器，通常用代理服务器的链接（经由非加密的HTTP代理服务器）



## HTTP状态码

所有HTTP响应的第一行都是状态行，依次是当前HTTP版本号，3位数字组成的状态代码，以及描述状态的短语，彼此有空格分割

| 状态码 | 类别                             | 原因短语                   |
| ------ | -------------------------------- | -------------------------- |
| 1XX    | Infomational（信息性状态码）     | 接收的请求正在处理         |
| 2XX    | Success（成功状态码）            | 请求正常处理完毕           |
| 3XX    | Redirection（重定向状态码）      | 需要进行附加操作以完成请求 |
| 4XX    | Client Error（客户端错误状态码） | 服务器无法处理请求         |
| 5XX    | Server Error（服务器错误状态码） | 服务器处理请求出错         |



## URL

超文本传输协议（HTTP）的统一资源定位符将从因特网获取信息的五个基本要素包括在一个简单的地址中

1. 传输协议：HTTP
2. 层级URL标记符号：//
3. 访问资源需要的凭证信息：可省略
4. 服务器：通常为域名，有时为IP地址
5. 端口号：以数字方式表示，若为HTTP的默认值":80"可省略
6. 路径：以'/'字符区别路径中的每一个目录名称
7. 查询：GET模式的窗体参数，以'?'字符为起点，每个参数以'&'隔开，再以'='分开参数名称与数据，通常以UTF8的URL编码，避开字符冲突的问题
8. 片段：以'#'字符为起点



## 请求应答协议

### 请求协议

![image-20211118213346004](/home/gaoxiang/.config/Typora/typora-user-images/image-20211118213346004.png)

### 应答协议

![image-20211118214227686](/home/gaoxiang/.config/Typora/typora-user-images/image-20211118214227686.png)





## 执行CGI程序

如果浏览器请求的是一个可执行文件（不管什么样的可执行文件，即使是shell脚本也一样），那么服务器并不把这个文件本身发给浏览器，而是把它执行结果标准输出发给浏览器



## web浏览器工作流程

1. 解析浏览器的请求，在服务目录中查找相应文件，找不到该文件就返回404错误页面
2. 如果找到了浏览器请求的文件，用stat(2)查看它是否可执行
3. 如果该文件可执行：
   1. 发送HTTP/1.1 200 0K给客户端
   2. fork(2)，然后用dup2(2)重定向子进程的标准输出到客户端socket
   3. 在子进程中exec(3)该CGI程序
   4. 关闭连接
4. 如果该文件不可执行
   1. 发送HTTP/1.1 200 0K给客户端
   2. 如果是一个图片文件，根据图片的扩展名发送相应的Content-Type给客户端
   3. 如果不是图片文件，这里简化处理，都当作Content-Type: text/
   4. 简单的HTTP协议头有这两行就足够了，再发一个空行表示结束
   5. 读取文件的内容发送到客户端
   6. 关闭连接



